if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(f){"use strict";f.fn.Tabledit=function(t){function n(i){var t=s.find(".tabledit-input").serialize()+"&action="+i;if(!1===o.onAjax(i,t))return!1;var e=f.post(o.url,t,function(t,e,n){i===o.buttons.edit.action&&(a.removeClass(o.dangerClass).addClass(o.warningClass),setTimeout(function(){s.find("tr."+o.warningClass).removeClass(o.warningClass)},1400)),o.onSuccess(t,e,n)},"json");return e.fail(function(t,e,n){i===o.buttons.delete.action?(d.removeClass(o.mutedClass).addClass(o.dangerClass),d.find(".tabledit-toolbar button").attr("disabled",!1),d.find(".tabledit-toolbar .tabledit-restore-button").hide()):i===o.buttons.edit.action&&a.addClass(o.dangerClass),o.onFail(t,e,n)}),e.always(function(){o.onAlways()}),e}if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var s=this,e={url:window.location.href,inputClass:"form-control input-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},delete:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:"Save"},restore:{class:"btn btn-sm btn-warning",html:"Restore",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},o=f.extend(!0,e,t),a="undefined",d="undefined",i={identifier:function(){o.hideIdentifier&&s.find("th:nth-child("+parseInt(o.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(o.columns.identifier[0])+"1)").hide(),s.find("tbody td:nth-child("+(parseInt(o.columns.identifier[0])+1)+")").each(function(){var t='<span class="tabledit-span tabledit-identifier">'+f(this).text()+"</span>",e='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+o.columns.identifier[1]+'" value="'+f(this).text()+'" disabled>';f(this).html(t+e),f(this).parent("tr").attr(o.rowIdentifier,f(this).text())})},editable:function(){for(var e=0;e<o.columns.editable.length;e++){s.find("tbody td:nth-child("+(parseInt(o.columns.editable[e][0])+1)+")").each(function(){var n=f(this).text();o.editButton||f(this).css("cursor","pointer");var t='<span class="tabledit-span">'+n+"</span>";if(void 0!==o.columns.editable[e][2]){var i='<select class="tabledit-input '+o.inputClass+'" name="'+o.columns.editable[e][1]+'" style="display: none;" disabled>';f.each(jQuery.parseJSON(o.columns.editable[e][2]),function(t,e){i+=n===e?'<option value="'+t+'" selected>'+e+"</option>":'<option value="'+t+'">'+e+"</option>"}),i+="</select>"}else i='<input class="tabledit-input '+o.inputClass+'" type="text" name="'+o.columns.editable[e][1]+'" value="'+f(this).text()+'" style="display: none;" disabled>';f(this).html(t+i),f(this).addClass("tabledit-view-mode")})}},toolbar:function(){if(o.editButton||o.deleteButton){var t="",e="",n="",i="",a="";0===s.find("th.tabledit-toolbar-column").length&&s.find("tr:first").append('<th class="tabledit-toolbar-column"></th>'),o.editButton&&(t='<button type="button" class="tabledit-edit-button '+o.buttons.edit.class+'" style="float: none;">'+o.buttons.edit.html+"</button>"),o.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+o.buttons.delete.class+'" style="float: none;">'+o.buttons.delete.html+"</button>",a='<button type="button" class="tabledit-confirm-button '+o.buttons.confirm.class+'" style="display: none; float: none;">'+o.buttons.confirm.html+"</button>"),o.editButton&&o.saveButton&&(n='<button type="button" class="tabledit-save-button '+o.buttons.save.class+'" style="display: none; float: none;">'+o.buttons.save.html+"</button>"),o.deleteButton&&o.restoreButton&&(i='<button type="button" class="tabledit-restore-button '+o.buttons.restore.class+'" style="display: none; float: none;">'+o.buttons.restore.html+"</button>");var d='<div class="tabledit-toolbar '+o.toolbarClass+'" style="text-align: left;">\n                                           <div class="'+o.groupClass+'" style="float: none;">'+t+e+"</div>\n                                           "+n+"\n                                           "+a+"\n                                           "+i+"\n                                       </div></div>";s.find("tr:gt(0)").append('<td style="white-space: nowrap; width: 1%;">'+d+"</td>")}}},l=function(t){var e=f(t).parent("tr");f(t).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),f(t).find(".tabledit-input").blur().hide().prop("disabled",!0),f(t).find(".tabledit-span").show(),f(t).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),o.editButton&&(e.find("button.tabledit-save-button").hide(),e.find("button.tabledit-edit-button").removeClass("active").blur())},r=function(t){c.reset(t);var e=f(t).parent("tr");e.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),f(t).find(".tabledit-span").hide();var n=f(t).find(".tabledit-input");n.prop("disabled",!1).show(),o.autoFocus&&n.focus(),f(t).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),o.editButton&&(e.find("button.tabledit-edit-button").addClass("active"),e.find("button.tabledit-save-button").show())},u=function(t){f(t).each(function(){var t=f(this).find(".tabledit-input"),e=f(this).find(".tabledit-span").text();t.is("select")?t.find("option").filter(function(){return f.trim(f(this).text())===e}).attr("selected",!0):t.val(e),l(this)})},b=function(t){!1!==n(o.buttons.edit.action)&&(f(t).each(function(){var t=f(this).find(".tabledit-input");f(this).find(".tabledit-span").text(t.is("select")?t.find("option:selected").text():t.val()),l(this)}),a=f(t).parent("tr"))},c={reset:function(t){s.find(".tabledit-confirm-button").hide(),s.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(t){c.reset(t),f(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=n(o.buttons.delete.action);f(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(f(t).parent("tr").addClass("tabledit-deleted-row"),f(t).parent("tr").addClass(o.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),f(t).find(".tabledit-restore-button").show(),d=f(t).parent("tr"))},confirm:function(t){s.find("td.tabledit-edit-mode").each(function(){u(this)}),f(t).find(".tabledit-delete-button").addClass("active"),f(t).find(".tabledit-confirm-button").show()},restore:function(t){f(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=n(o.buttons.restore.action);f(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(f(t).parent("tr").removeClass("tabledit-deleted-row"),f(t).parent("tr").removeClass(o.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),f(t).find(".tabledit-restore-button").hide(),f(t).parent("tr"))}};return i.identifier(),i.editable(),i.toolbar(),o.onDraw(),o.deleteButton&&(s.on("click","button.tabledit-delete-button",function(t){if(!0!==t.handled){t.preventDefault();var e=f(this).hasClass("active"),n=f(this).parents("td");c.reset(n),e||c.confirm(n),t.handled=!0}}),s.on("click","button.tabledit-confirm-button",function(t){if(!0!==t.handled){t.preventDefault();var e=f(this).parents("td");c.submit(e),t.handled=!0}})),o.restoreButton&&s.on("click","button.tabledit-restore-button",function(t){!0!==t.handled&&(t.preventDefault(),c.restore(f(this).parents("td")),t.handled=!0)}),o.editButton?(s.on("click","button.tabledit-edit-button",function(t){if(!0!==t.handled){t.preventDefault();var e=f(this),n=e.hasClass("active");u(s.find("td.tabledit-edit-mode")),n||f(e.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){r(this)}),t.handled=!0}}),s.on("click","button.tabledit-save-button",function(t){!0!==t.handled&&(t.preventDefault(),b(f(this).parents("tr").find("td.tabledit-edit-mode")),t.handled=!0)})):(s.on(o.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),u(s.find("td.tabledit-edit-mode")),r(this),t.handled=!0)}),s.on("change","select.tabledit-input:visible",function(){!0!==event.handled&&(b(f(this).parent("td")),event.handled=!0)}),f(document).on("click",function(t){var e=s.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||u(s.find(".tabledit-input:visible").parent("td"))})),f(document).on("keyup",function(t){var e=s.find(".tabledit-input:visible"),n=s.find(".tabledit-confirm-button");if(0<e.length)var i=e.parents("td");else{if(!(0<n.length))return;i=n.parents("td")}switch(t.keyCode){case 9:o.editButton||(b(i),r(i.closest("td").next()));break;case 13:b(i);break;case 27:u(i),c.reset(i)}}),this}}(jQuery),jQuery;